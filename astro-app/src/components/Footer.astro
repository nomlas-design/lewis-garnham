---
import Button from './Button.astro';
---

<footer id='contact' class='section footer'>
  <div class='container'>
    <div class='grid grid--footer'>
      <div class='content'>
        <div class='contact'>
          <h1>Contact</h1>
          <img class='contact__arrow' src='/SVG/arrow.svg' alt='' />

          <Button
            class='contact'
            icon='/SVG/email.svg'
            text='daisy@pbjmanagement.co.uk'
            href='mailto:daisy@pbjmanagement.co.uk'
          />
        </div>
        <div class='copy'>
          <h2 class='copy__title'>Join the Mailing List</h2>
          <p class='copy__body'>
            Join Lewis Garnham's mailing list for show alerts and exclusive
            offers.
          </p>
          <iframe name='hidden_iframe' id='hidden_iframe' style='display:none;'
          ></iframe>
          <form
            class='mailing-list__form'
            id='mailing-list-form'
            action='https://docs.google.com/forms/d/e/1FAIpQLSfrOqkUab27uMUbp1bOFDI8RaUAqztSiadkMgro6v3jPlW18w/formResponse'
            method='POST'
            target='hidden_iframe'
          >
            <div class='form-group'>
              <label for='email' class='sr-only'>Email *</label>
              <input
                type='email'
                id='email'
                name='entry.1888566909'
                required
                placeholder='Email'
              />
            </div>
            <div class='form-group'>
              <label for='postcode' class='sr-only'>Postcode/ZIP Code *</label>
              <input
                type='text'
                id='postcode'
                name='entry.1104418972'
                required
                placeholder='Postcode/ZIP Code'
              />
            </div>
            <Button text='Subscribe' type='submit' class='primary' />
          </form>
          <div id='success-message' style='display:none;' class='form-message'>
            Thanks for subscribing! We'll keep you updated.
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>

<script>
  const form = document.getElementById('mailing-list-form') as HTMLFormElement;
  const iframe = document.getElementById('hidden_iframe') as HTMLIFrameElement;
  const successMessage = document.getElementById(
    'success-message'
  ) as HTMLElement;
  let submitted = false;

  if (form && iframe) {
    form.addEventListener('submit', function () {
      submitted = true;
    });

    iframe.addEventListener('load', function () {
      if (submitted) {
        // Hide form and show success message
        form.style.display = 'none';
        successMessage.style.display = 'block';
        successMessage.style.color = '#ffbb28';
        successMessage.style.fontWeight = '600';
        submitted = false;
      }
    });
  }
</script>
