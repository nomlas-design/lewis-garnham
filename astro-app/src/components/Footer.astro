---
import Button from './Button.astro';
---

<footer id='contact' class='section footer'>
  <div class='container'>
    <div class='grid grid--footer'>
      <div class='content'>
        <div class='contact'>
          <h1>Contact</h1>
          <img class='contact__arrow' src='/SVG/arrow.svg' alt='' />

          <Button
            class='contact'
            icon='/SVG/email.svg'
            text='humblemagpie@gmail.com'
            href='mailto:humblemagpie@gmail.com'
          />
        </div>
        <div class='copy'>
          <h2 class='copy__title'>Join the Mailing List</h2>
          <p class='copy__body'>
            Join Lewis Garnham's mailing list for show alerts and exclusive
            offers.
          </p>
          <form
            class='mailing-list__form'
            id='mailing-list-form'
          >
            <div class='form-group'>
              <label for='email' class='sr-only'>Email *</label>
              <input
                type='email'
                id='email'
                name='email'
                required
                placeholder='Email'
              />
            </div>
            <div class='form-group'>
              <label for='postcode' class='sr-only'>Postcode/ZIP Code *</label>
              <input
                type='text'
                id='postcode'
                name='postcode'
                required
                placeholder='Postcode/ZIP Code'
              />
            </div>
            <Button text='Subscribe' type='submit' class='primary' />
          </form>
        </div>
      </div>
    </div>
  </div>
</footer>

<script>
  const form = document.getElementById('mailing-list-form') as HTMLFormElement;

  if (form) {
    form.addEventListener('submit', function (e) {
      e.preventDefault();

      const email = (document.getElementById('email') as HTMLInputElement).value;
      const postcode = (document.getElementById('postcode') as HTMLInputElement).value;

      // Construct the Google Form prefilled URL
      const formUrl = `https://docs.google.com/forms/d/e/1FAIpQLSfrOqkUab27uMUbp1bOFDI8RaUAqztSiadkMgro6v3jPlW18w/formResponse?entry.1099704569=${encodeURIComponent(email)}&entry.2050371045=${encodeURIComponent(postcode)}&submit=Submit`;

      // Open in a new tab (or could use fetch with no-cors mode)
      fetch(formUrl, {
        method: 'POST',
        mode: 'no-cors',
      }).then(() => {
        // Show success message
        const messageDiv = document.createElement('div');
        messageDiv.className = 'form-message';
        messageDiv.textContent = 'Thanks for subscribing!';
        form.appendChild(messageDiv);
        form.reset();
        setTimeout(() => messageDiv.remove(), 5000);
      }).catch(() => {
        // Even on error, Google Forms usually accepts the submission
        const messageDiv = document.createElement('div');
        messageDiv.className = 'form-message';
        messageDiv.textContent = 'Thanks for subscribing!';
        form.appendChild(messageDiv);
        form.reset();
        setTimeout(() => messageDiv.remove(), 5000);
      });
    });
  }
</script>
